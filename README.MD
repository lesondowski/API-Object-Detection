# YOLO Object Detection API (No Copyright Statement) âœ…

**MÃ´ táº£ ngáº¯n:**
Dá»± Ã¡n cung cáº¥p má»™t API phÃ¡t hiá»‡n váº­t thá»ƒ dá»±a trÃªn mÃ´ hÃ¬nh YOLO, dÃ¹ng FastAPI lÃ m backend. á»¨ng dá»¥ng há»— trá»£ gá»­i URL áº£nh hoáº·c upload áº£nh tá»« mÃ¡y, thá»±c hiá»‡n phÃ¡t hiá»‡n vÃ  tráº£ vá» káº¿t quáº£ cá»™ng hÃ¬nh áº£nh Ä‘Ã£ Ä‘Ã¡nh dáº¥u (bounding boxes) â€” táº¥t cáº£ xá»­ lÃ½ trong bá»™ nhá»›, khÃ´ng lÆ°u file lÃªn Ä‘Ä©a.

---

## ğŸ”§ TÃ­nh nÄƒng chÃ­nh
- Nháº­n áº£nh tá»« URL hoáº·c upload file qua form
- Tráº£ vá» JSON káº¿t quáº£ cho API programmatic (`/predict/`)
- Giao diá»‡n web Ä‘Æ¡n giáº£n (Jinja2) Ä‘á»ƒ submit URL/upload vÃ  xem áº£nh Ä‘Ã£ annotate (`/` â†’ form)
- Váº½ bounding boxes báº±ng OpenCV; khÃ´ng lÆ°u áº£nh lÃªn Ä‘Ä©a (in-memory + tráº£ vá» data URI)

---

## ğŸ“ Cáº¥u trÃºc thÆ° má»¥c (tÃ³m táº¯t)
- `api/` â€” FastAPI app
  - `main.py` â€” entrypoint vÃ  cáº¥u hÃ¬nh templates/static
  - `routers/predict_router.py` â€” API vÃ  web routes
- `models/predict.py` â€” load áº£nh, gá»i model, helper xá»­ lÃ½ áº£nh
- `api/files/model/` â€” chá»©a cÃ¡c mÃ´ hÃ¬nh (.pt, .onnx, tflite)
- `templates/` â€” Jinja2 HTML templates (home / results)
- `static/` â€” tÃ i nguyÃªn tÄ©nh (CSS/JS náº¿u cáº§n)
- `requirements.txt` â€” thÆ° viá»‡n cáº§n cÃ i Ä‘áº·t

---

## âš™ï¸ YÃªu cáº§u & cÃ i Ä‘áº·t
- Python 3.10+
- CÃ i Ä‘áº·t dependencies:

```bash
pip install -r requirements.txt
```

LÆ°u Ã½: láº§n cháº¡y Ä‘áº§u tiÃªn cÃ³ thá»ƒ cháº­m do táº£i mÃ´ hÃ¬nh; cáº§n cÃ³ káº¿t ná»‘i internet náº¿u mÃ´ hÃ¬nh cáº§n táº£i.

---

## ğŸ›  Cáº¥u hÃ¬nh mÃ´ hÃ¬nh (quick)
Má»Ÿ `utils_cf/config.py` Ä‘á»ƒ chá»‰nh:
```python
DEVICE = "cuda" if torch.cuda.is_available() else "cpu"
MODEL_OD_PT = "api/files/model/pt/ADYL11m.pt"
MODEL_IS_ONNX = "api/files/model/onnx/AD_YL11s_Seg_1.80.onnx"
MODEL_BLOCK_PT = "api/files/model/pt/AD_Productblock_YL11.pt"
```
- Thay Ä‘Æ°á»ng dáº«n tá»›i mÃ´ hÃ¬nh mong muá»‘n náº¿u cáº§n.
- Äá»ƒ Ã©p cháº¡y trÃªn CPU, Ä‘áº·t `DEVICE = "cpu"`.

---

## â–¶ï¸ Cháº¡y server (local)
```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 10000
```
Má»Ÿ trÃ¬nh duyá»‡t tá»›i `http://localhost:10000/` Ä‘á»ƒ truy cáº­p giao diá»‡n web, hoáº·c dÃ¹ng Postman Ä‘á»ƒ gá»i API.

---

## ğŸ“¬ API & Web endpoints
1) POST `/predict/` (JSON) â€” programmatic
- Body JSON:
```json
{
  "image_urls": ["https://example.com/img1.jpg"],
  "conf_input": 0.24,
  "iou_input": 0.2,
  "portion": "Lon & Chai",
  "repuirements_count": 1
}
```
- Tráº£ vá»: JSON chá»©a thá»‘ng kÃª phÃ¡t hiá»‡n (sá»‘ lÆ°á»£ng theo lá»›p, thÃ´ng tin block náº¿u Ã¡p dá»¥ng).

2) POST `/predict/detect_form` (form-data) â€” web form / Postman file upload
- Fields (form-data):
  - `image_urls` (text, má»—i URL 1 dÃ²ng)
  - `files` (file, há»— trá»£ nhiá»u files)
  - `conf_input`, `iou_input`, `portion`, `repuirements_count`
- Tráº£ vá»: HTML trang káº¿t quáº£ cÃ³ áº£nh Ä‘Ã£ annotate (embedded data URI) vÃ  JSON counts.

3) GET `/` â€” form web Ä‘á»ƒ input URL / upload áº£nh.

---

## ğŸ§ª Test nhanh báº±ng Postman / curl
- JSON request (URL flow):
```bash
curl -X POST "http://localhost:10000/predict/" -H "Content-Type: application/json" -d '{"image_urls":["https://example.com/img.jpg"]}'
```
- File upload (form):
```bash
curl -X POST "http://localhost:10000/predict/detect_form" -F "files=@/path/to/image.jpg" -F "conf_input=0.24"
```

---

## ğŸ’¡ Gá»£i Ã½ gá»¡ lá»—i
- `Cannot download image` â†’ kiá»ƒm tra URL (public & tráº£ mÃ£ 200).
- `Cannot decode uploaded file` â†’ kiá»ƒm tra file (kháº£ nÄƒng OpenCV khÃ´ng Ä‘á»c Ä‘Æ°á»£c; code cÃ³ fallback dÃ¹ng PIL).
- Náº¿u inference quÃ¡ cháº­m, thá»­ giáº£m `conf_input`/`iou_input` hoáº·c cháº¡y trÃªn mÃ¡y cÃ³ GPU.

---

Náº¿u báº¡n muá»‘n tÃ´i thÃªm: báº£n README tiáº¿ng Anh, Dockerfile máº«u, hoáº·c má»™t Postman Collection máº«u Ä‘á»ƒ import â€” nÃ³i tÃ´i biáº¿t má»¥c nÃ o báº¡n muá»‘n tÃ´i bá»• sung.
